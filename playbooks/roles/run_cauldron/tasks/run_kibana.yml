---

- name: Check Kibana Running
  uri:
    url: "https://{{ (ansible_ssh_host|default(ansible_host))|default(inventory_hostname) }}/kibana"
    method: GET
    validate_certs: no
  register: check_kibana
  failed_when: false


- name: Run Kibana
  docker_container:
    name: "{{ kibana_container_name }}"
    image: "{{ kibana_image }}"
    state: started
    restart: "{{ 'yes' if check_kibana.status != 200 else 'no'}}"
    networks:
      - name: "{{ network_name }}"
    volumes:
      - "{{configuration_dir}}/kibana/kibana.yml:/usr/share/kibana/config/kibana.yml"
      - "{{configuration_dir}}/es/keys/root-ca.pem:/usr/share/kibana/config/root-ca.pem"
